<!DOCTYPE>
<html>
	<head>
		<title>Schnarchbox</title>
		<meta charset="utf-8" /> 
		<link rel='stylesheet' href='styles/style.css'></link>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,300italic,400italic' rel='stylesheet' type='text/css'>
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
		<script src="http://cdn.socket.io/socket.io-1.2.0.js"></script>
		<script>
			var server = "http://localhost/schnarch/";

			var audio = new Audio(server + 'assets/alarm.wav');

			$(document).ready(function() {
				// var socket = io.connect('http://172.16.103.40:1337/');
				var socket = io.connect('http://localhost:1337/');
				socket.emit("stateRequest", "");
				var currentTime;

				socket.on("alarm", function(data) {
					console.log("alrm");
					audio.play();
				});

				socket.on("time", function(data) {
					$("#main #overview .time").text(data);
				});

				$("#main #destination").hide();	
				$("#main #destinationtime").hide();
				$("#main #test").hide();
				$("#main #done").hide();

				$("#main #overview").click(function() {					
					$("#main #overview").fadeOut( "slow", function() {
						$("#main #destinationtime").fadeIn( "slow", function() {
							// DestinationTime
							var currentHour = "07";
							var currentMinute = "00";

							currentTime = currentHour + ":" + currentMinute;

							$("#plus").click(function() {
								if(currentMinute < 45) {
									currentMinute = parseInt(currentMinute) + 15;
								} else {
									currentHour = parseInt(currentHour) + 1;
									if(currentHour < 10) {
										currentHour = "0" + currentHour;
									} else if (currentHour > 23) {
										currentHour = "00";
									}
										currentMinute = "00";
								}
								currentTime = currentHour + ":" + currentMinute;
								$("#destinationtime .time").text(currentHour + 	":" + currentMinute);
							});

							$("#minus").click(function() {
								if(currentMinute > 14) {
									currentMinute = parseInt(currentMinute) - 15;
									if(currentMinute == 0) {
										currentMinute = "00";
									}
								} else {
									currentMinute = 45;
									currentHour = parseInt(currentHour) - 1;
									if(currentMinute > 10) {
										currentHour = "0" + currentHour;
									}
								}
								currentTime = currentHour + ":" + currentMinute;
								$("#destinationtime .time").text(currentTime);
							});

							$("#destinationtime .time").click(function() {
								$("#main #destinationtime").fadeOut( "slow", function() {
									$("#main #destination").fadeIn( "slow", function() {

										$("li").click(function() {

											console.log(currentTime);
											var request = {
												time: currentTime
											};
											socket.emit('sendRequest', JSON.stringify(request));

											socket.on('sendAnswer', function(data) {
												console.log('sendAnswer: ' + data);
												var answer = JSON.parse(data);

												var minute = answer.time.substring(3,5);
												var hour = answer.time.substring(0,2);

												var currentHour = hour;
												var currentMinute = minute;

												$("#main #test .time").text(answer.time);
											});

											$("#main #destination").fadeOut( "slow", function() {
												$("#main #test").fadeIn( "slow", function() {

							$("#test #plus").click(function() {
								if(currentMinute < 45) {
									currentMinute = parseInt(currentMinute) + 15;
								} else {
									currentHour = parseInt(currentHour) + 1;
									if(currentHour < 10) {
										currentHour = "0" + currentHour;
									} else if (currentHour > 23) {
										currentHour = "00";
									}
										currentMinute = "00";
								}
								currentTime = currentHour + ":" + currentMinute;
								$("#test .time").text(currentHour + 	":" + currentMinute);
							});

							$("#test #minus").click(function() {
								if(currentMinute > 14) {
									currentMinute = parseInt(currentMinute) - 15;
									if(currentMinute == 0) {
										currentMinute = "00";
									}
								} else {
									currentMinute = 45;
									currentHour = parseInt(currentHour) - 1;
									if(currentMinute > 10) {
										currentHour = "0" + currentHour;
									}
								}
								currentTime = currentHour + ":" + currentMinute;
								$("#test .time").text(currentTime);
							});

							$("#test .time").click(function() {
								$("#main #test").fadeOut( "slow", function() {
									$("#main #done").fadeIn( "slow", function() {
										$("#main #done").fadeOut( "slow", function() {
											$("#main #overview").fadeIn( "slow", function() {

											});
										});
									});
								});
							});							

												});
											});
										});

									});
								});
							});
						});
					});
				});

				// $(".submit").click(function() {
				// 	$("#main #destination").fadeOut( "slow", function() {
				// 		$("#main #test").fadeIn( "slow", function() {

				// 		});
				// 	});
				// });

			});

		    // function getForecast() {
		    // 	// Do Stuff
		    //     alert($("#destination .textfield").val());

		    //     $("#main #destination").fadeOut( "slow", function() {

		    //     });
		    // }
		</script>
	</head>
	<body>
		<div id="main">
			<p id="overview">
				<span class="time">
					23:25
				</span><br>
				<span class="date">
					Montag, 01. MÃ¤rz 2016
				</span>
			</p>


			<p id="destinationtime">
				<span class="time">
					07:00
				</span><br>
				<input id="minus" type="submit" value="-">
				<input id="plus" type="submit" value="+">
			</p>

			<div id="destination">
				<input class="textfield" type="text" name="destination" placeholder="Ziel"><br>
				<ul>
					<li><img src="assets/bus.svg.svg"></li>
					<li><img src="assets/plane.svg.svg"></li>
					<li><img src="assets/taxi.svg.svg"></li>
					<li><img src="assets/train.svg.svg"></li>
				</ul>
			</div>

			<p id="test">
				<span class="time">
					09:42
				</span><br>
				<input id="minus" type="submit" value="-">
				<input id="plus" type="submit" value="+">
			</p>

			<p id="done">
				<span class="time">
					Fertig!
				</span><br>
			</p>
		</div>
	</body>
</html>